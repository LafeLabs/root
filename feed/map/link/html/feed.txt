<p><a href = "feededitor.php?path=map/link/">feededitor.php?path=map/link/</a></p>
<p><a id= "this" href = "http://localhost:8000/feed/index.php?path=map/link/&json=../page/map/link/json/">this</a></p>
<div id = "feed">
    
<img id = "backgroundimage"/>

</div>
<script>

mapjson = {
    "imgurl": "http://res.cloudinary.com/geometron/image/upload/v1531451013/bigdcsketch_ktsx8v.png",
    "imgw": 123.91323276088887,
    "imgleft": -74.00179562838251,
    "imgtop": -77.24720546595957,
    "unitpixels": 4,
    "unitfeet": 555,
    "imgangle": -1,
    "latlon0": "38.889464, -77.035246",
    "marker0": "Washington Monument"
}
    x0 = 0.5*innerWidth;
    y0 = 0.5*innerHeight;

document.getElementById("backgroundimage").src = mapjson.imgurl;
document.getElementById("backgroundimage").style.width = (mapjson.imgw*mapjson.unitpixels).toString() + "px";
document.getElementById("backgroundimage").style.left = (x0 + mapjson.imgleft*mapjson.unitpixels).toString() + "px";
document.getElementById("backgroundimage").style.top = (y0 + mapjson.imgtop*mapjson.unitpixels).toString() + "px";

    jsondata = JSON.parse(document.getElementById("jsondata").innerHTML);
    x=0;
    y=0;
    for(var index = 0;index < jsondata.length;index++){
        var newa = document.createElement("A");
        newa.href = jsondata[index].url;
        newa.innerHTML = jsondata[index].text;
        newa.className = "linklist";
        newa.style.transform = "rotate(" + jsondata[index].rotation + "deg)";

        x = parseFloat(latlon2xy(jsondata[index].latlon).split(",")[0])*mapjson.unitpixels;
        y = parseFloat(latlon2xy(jsondata[index].latlon).split(",")[1])*mapjson.unitpixels;
        newa.style.fontSize = (mapjson.unitpixels*jsondata[index].fontfeet/mapjson.unitfeet).toString() + "px";
        newa.style.left = (x0 + x).toString() + "px";
        newa.style.top = (y0 - y).toString() + "px";
        document.getElementById("feed").appendChild(newa);
    }


function latlon2xy(latlonin) {
    
    //input to this function is a string of the form "lattitude,longitude", where lat and lon are in decimal degrees
    var lat0 = parseFloat(mapjson.latlon0.split(",")[0]);   //lattitude to 10 meter precision
    var coslat = Math.cos(lat0*Math.PI/180);//convert to radians, take cosine of lattitude
    var lon0 =  parseFloat(mapjson.latlon0.split(",")[1]);//longitude to 10 meter precision
    var unitfeet = mapjson.unitfeet;//unit length in feet

    var digits = 1;//1;//0 digits = 555 feet, 1 is 55 feet, 2 is 5.5  feet
    var precision = Math.pow(10,digits);

    var lat1 = parseFloat(latlonin.split(",")[0]);
    var lon1 = parseFloat(latlonin.split(",")[1]);
    //from the original definition of the meter:
    //90 degrees lattitude = 10,000,000 meters = 32808399 feet
    //1 degree lattitude = 10,000,000 meters/90 = 111111.1 meters = 111 km
    //0.1 degree = 11 km
    //0.01 degree = 1.1 km
    //0.001 degree = 110 m
    //0.0001 degree = 11 m
    //1 meter = 3.28084 feet
    //1 degree lattitude = 111111.1(meters)*3.28084(feet/meter) = 364538 feet
    //1 degree longitude = 1 degre lattitude X cos(lattitude) = 283699 feet at 38.8895 N
    var deltaxfeet = Math.round((lon1 - lon0)*364538*coslat);//convert longitude difference to feet
    var deltayfeet = Math.round((lat1 - lat0)*364538);//convert lattitude difference to feet
    var deltax = Math.round(precision*deltaxfeet/unitfeet)/precision;//convert from feet to "units" based on unitfeet
    var deltay = Math.round(precision*deltayfeet/unitfeet)/precision;//convert from feet to "units" based on unitfeet
    return deltax.toString() + "," + deltay.toString();
}
</script>
<style>
a{
    z-index:3;
}
.unit{
    position:relative;
    width:80%;
    margin:auto;
}
.bottomimage{
   position:relative;
    
}
.topimage{
   position:absolute;
}
img{
   top:0px;
   width:500px;
   left:0px;
}
#feed{
    position:absolute;
    left:0px;
    top:2em;
    bottom:0px;
    right:0px;
    overflow:scroll;
}
.linklist{
    position:absolute;
}
#backgroundimage{
    position:absolute;
}
#this{
    position:absolute;
    right:1em;
    top:0px;
    z-index:3;
}
</style>
